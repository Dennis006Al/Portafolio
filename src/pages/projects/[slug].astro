---
import { getCollection, type CollectionEntry } from 'astro:content';
import { AstroError } from 'astro/errors';
import BaseLayout from '~/layouts/BaseLayout.astro';

// Exportar los slugs para que Astro genere las páginas
export async function getStaticPaths() {
  const projects: CollectionEntry<'projects'>[] =
    await getCollection('projects');

  return projects.map((project) => ({
    params: { slug: project.data.slug },
    props: { project },
  }));
}

// Obtener el slug dinámico
const { project } = Astro.props;

if (!project) {
  throw new AstroError(`Project not found`);
}

const { title, description, year, image, featuredImage, url } = project.data;
---

<BaseLayout>
  <Fragment slot="title">{title}</Fragment>

  <main class="w-full px-4 sm:px-8 lg:px-32 2xl:px-64 pt-24 font-sans">
    <p class="text-zinc-400 mb-2 text-lg">{year}</p>
    <h1 class="text-4xl font-bold text-white mb-4">{title}</h1>
    <p class="text-md text-zinc-300 mb-8 max-w-5xl">{description}</p>
    {
      url && url !== '#' && (
        <a
          href={url}
          target="_blank"
          rel="noopener noreferrer"
          class="group inline-flex items-center gap-2 px-4 py-2 mb-8 rounded-md border border-white/10 bg-white/5 text-white text-sm font-medium backdrop-blur-sm transition hover:bg-white/10 hover:border-white/20 hover:drop-shadow-md website-button"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-earth-icon"
          >
            <path d="M21.54 15H17a2 2 0 0 0-2 2v4.54" />
            <path d="M7 3.34V5a3 3 0 0 0 3 3a2 2 0 0 1 2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2c0-1.1.9-2 2-2h3.17" />
            <path d="M11 21.95V18a2 2 0 0 0-2-2a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05" />
            <circle cx="12" cy="12" r="10" />
          </svg>
          Website
        </a>
      )
    }

    <img
      src={featuredImage || image}
      alt={title}
      class="w-full max-w-5xl rounded-xl border border-zinc-800 mb-6 shadow-[0_0_10px_rgba(255,255,255,0.2),0_0_20px_rgba(255,255,255,0.10)]"
      loading="lazy"
    />
    <h2 class="text-xl font-bold text-white mt-12 mb-4">Overview</h2>
    <p class="text-zinc-400">
      This project was built to help gym staff manage contracts efficiently
      using a custom admin dashboard...
    </p>

    <h2 class="text-xl font-bold text-white mt-12 mb-4">Objective</h2>
    <p class="text-zinc-400">
      Improve the reliability of an internal tool that automates member
      contracts and client registration...
    </p>

    <h2 class="text-xl font-bold text-white mt-12 mb-4">Tech Stack</h2>
    <ul class="list-disc list-inside text-zinc-300">
      <li>Angular (Frontend SPA)</li>
      <li>Laravel (RESTful API backend)</li>
      <li>MySQL (Database)</li>
    </ul>

    <h2 class="text-xl font-bold text-white mt-12 mb-4">Key Contributions</h2>
    <ul class="list-disc list-inside text-zinc-300">
      <li>Fixed contract signature bug affecting over 50% of clients</li>
      <li>Refactored authentication flow</li>
      <li>Added feature to preview and print documents</li>
    </ul>

    <h2 class="text-xl font-bold text-white mt-12 mb-4">Reflection</h2>
    <p class="text-zinc-400">
      This project helped me deepen my understanding of debugging large Angular
      codebases under pressure...
    </p>

    <!-- Botón de regreso a /projects -->
    <div class="mt-8 mb-8">
      <a
        href="/projects"
        class="group inline-flex items-center text-base text-white relative"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="ml-2 transition-transform duration-300 group-hover:-translate-x-1"
          ><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg
        >
        <span class="link-underline-dotted">Explore more projects</span>
      </a>
    </div>
  </main>
</BaseLayout>
